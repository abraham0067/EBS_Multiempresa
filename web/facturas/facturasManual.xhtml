<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../templates/templateContent.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="breadcrum">
        <p:breadCrumb class="breadcrumbStyle" style="padding: 1px 1px 1px 1px;">
            <p:menuitem value="Inicio" url="#"/>
            <p:menuitem value="Facturas" url="#"/>
            <p:menuitem value="Facturaci&oacute;n manual" url="#"/>
        </p:breadCrumb>
    </ui:define>
    <ui:define name="controls">
    </ui:define>
    <ui:define name="content">
        <ui:debug/>
        <script type="text/javascript">
            function handleAddRequest(xhr, status, args) {
                if (args.validationFailed || !args.succes) {
                    PF('dlgAdd').jq.effect("shake", {times: 5}, 100);
                    console.log("false");
                    console.log(args.validationFailed);
                    console.log(args.succes);

                } else {
                    PF('dlgAdd').hide();
                    console.log("true");
                }
            }

            function handleRegNewRequest(xhr, status, args) {
                if (args.validationFailed || !args.succes) {
                    PF('dlg').jq.effect("shake", {times: 5}, 100);
                } else {
                    PF('dlg').hide();
                }
            }

            function handleFactResponse(xhr, status, args) {
                if (args.validationFailed || !args.succes) {
                    /*muestra un mensaje creado desde javascript
                   console.log("false");
                   PF('growlWV').renderMessage({"summary":"Ocurrio un error al procesar la factura",
                       "detail":"",
                       "severity":"warn"})*/
                } else {
                    $("#frmManual\\:hdnBtn").click();
                    /*
                    console.log("true");
                    PF('growlWV').renderMessage({"summary":"Factura generada correctamente",
                        "detail":"",
                        "severity":"info"})*/
                }
                PF('statusDialog').hide()
            }
        </script>
        <h:form id="frmManual">
            <p:growl id="msgs" showDetail="false" life="16000" autoUpdate="false"/>
            <p:growl widgetVar="growlWV"/>
            <p:panel header="FacturaciÃ³n manual" style="margin-bottom:10px;">
                <p:fieldset legend="Datos del emisor y receptor" toggleable="true" toggleSpeed="500" collapsed="false">
                    <p:panelGrid id="pfDatosEmiRec" columns="4"
                                 columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
                                 layout="grid" styleClass="ui-panelgrid-blank, ui-noborder" style="max-width: 1200px;">
                        <p:outputLabel for="somEmisor" value="Emisor: "/>
                        <p:selectOneMenu id="somEmisor" value="#{managedBeanFacturacionManual.idEmpresa}"
                                         style="width:98%; max-width: 100%" required="true"
                                         requiredMessage="Debe seleccionar una empresa emisora."
                                         filter="true" filterMatchMode="contains" panelStyle="width:550px;">
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanEmpresasAsignadas.empresasAsignadas}" var="em"
                                           itemLabel="#{em.RFC_Empresa()}" itemValue="#{em.id}"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanFacturacionManual.actualizaDatoPorEmpresaEmisora()}"
                                    process="@this,somEmisor"
                                    update="somClientes, somSerie, somMoneda, somConceptos, flsParams"
                                    onstart="PF('statusLoadingData').show()"
                                    oncomplete="PF('statusLoadingData').hide()"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanCatalogos.buscarRegimenByRfc(managedBeanFacturacionManual.idEmpresa)}"
                                    process="@this" update="somRegimen"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanCatalogos.buscarCodigoPostal(managedBeanFacturacionManual.codigoPostal)}"
                                    process="@this" update="somCodPost,itLugarExp"/>
                        </p:selectOneMenu>
                        <p:outputLabel for="somClientes" value="Cliente: "/>
                        <p:selectOneMenu id="somClientes" value="#{managedBeanFacturacionManual.idCliente}"
                                         style="width:98%; max-width: 100%" maxlength="200" required="true"
                                         requiredMessage="Debe seleccionar un cliente."
                                         panelStyle="width:550px;"
                                         filter="true" filterMatchMode="contains">
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanFacturacionManual.receptores}" var="r"
                                           itemLabel="#{r.rfcRazonSoc()}" itemValue="#{r.id}"/>
                            <p:ajax event="change" process="@this,somClientes"
                                    listener="#{managedBeanFacturacionManual.handleChangeReceptor()}"
                                    update="frmManual,flsAddenda,somNumRegIdTrib,somResidenciaFiscal,isUsarCompComExt"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanCatalogos.buscarUsoCfdiByRfc(managedBeanFacturacionManual.idCliente)}"
                                    update="somUso"/>
                        </p:selectOneMenu>
                        <p:outputLabel for="somRegimen" value="Regimen Fiscal(Emisor): "/>
                        <p:selectOneMenu id="somRegimen" value="#{managedBeanFacturacionManual.regimenFiscal}"
                                         style="width:98%; max-width: 100%" required="true"
                                         requiredMessage="Debe seleccionar un regimen fiscal."
                                         filter="true" filterMatchMode="contains" panelStyle="width:550px;">
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanCatalogos.regims}" var="reg"
                                           itemLabel="#{reg.clave}-#{reg.descripcion}"
                                           itemValue="#{reg.clave}-#{reg.descripcion}"/>
                            <p:ajax event="change" process="@this,somRegimen"/>
                        </p:selectOneMenu>
                        <p:outputLabel for="somUso" value="Uso CFDI(Cliente): "/>
                        <p:selectOneMenu id="somUso" value="#{managedBeanFacturacionManual.usoCfdi}"
                                         style="width:98%; max-width: 100%" required="true"
                                         requiredMessage="Debe seleccionar un uso."
                                         filter="true" filterMatchMode="contains" panelStyle="width:550px;">
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanCatalogos.usos}" var="us"
                                           itemLabel="#{us.clave}-#{us.descripcion}"
                                           itemValue="#{us.clave}-#{us.descripcion}"/>
                            <p:ajax event="change" process="@this,somUso" update="msgs,somUso"
                                    listener="#{managedBeanFacturacionManual.handleChangeUsoCFDI()}"/>
                        </p:selectOneMenu>


                        <p:outputLabel/>
                        <p:outputLabel/>
                        <p:outputLabel value="ResidenciaFiscal"/>
                        <p:selectOneMenu id="somResidenciaFiscal"
                                         value="#{managedBeanFacturacionManual.residenciaFiscal}"
                                         style="width:98%; max-width: 100%" required="true"
                                         requiredMessage="Seleccione el pais"
                                         filter="true" filterMatchMode="contains" panelStyle="width:550px;"
                                         binding="#{managedBeanFacturacionManual.inputResidenciaFiscal}"
                                         disabled="#{managedBeanFacturacionManual.requiredResidenciaFiscal eq managedBeanFacturacionManual.NO_REQUERIDO}">>
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanFacturacionManual.paises}" var="pais"
                                           itemLabel="#{pais.clave}-#{pais.descripcion}"
                                           itemValue="#{pais.clave}-#{pais.descripcion}"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanFacturacionManual.handleChangeResidenciaFiscal()}"
                                    process="@this,somResidenciaFiscal,msgs" update="@this,somResidenciaFiscal,msgs"/>
                        </p:selectOneMenu>


                        <p:outputLabel/>
                        <p:outputLabel/>
                        <p:outputLabel value="NumRegIdTrib"/>
                        <p:inputText id="somNumRegIdTrib" value="#{managedBeanFacturacionManual.numRegIdTrib}"
                                     binding="#{managedBeanFacturacionManual.inputNumRegIdTrib}"
                                     disabled="#{managedBeanFacturacionManual.requiredNumRegIdTrib eq managedBeanFacturacionManual.NO_REQUERIDO}"
                                     maxlength="40" autocomplete="off">
                            <p:ajax event="change" process="@this,somNumRegIdTrib,msgs" update="somNumRegIdTrib,msgs"
                                    listener="#{managedBeanFacturacionManual.handleChangeNumRegIdTrib()}"/>
                        </p:inputText>


                    </p:panelGrid>
                </p:fieldset>
                <ui:include src="/facturas/datosFacturaPart.xhtml"/>
                <ui:include src="/facturas/compComercioExterior/complementoComercioExteriorPart.xhtml"/>
                <p:fieldset legend="Comentarios" toggleable="true" toggleSpeed="500" collapsed="false">
                    <p:panelGrid class="panelCentered" columns="1" style="width: 50%; text-align: center;">
                        <p:inputTextarea id="itaComentarios" autoResize="true" cols="50" rows="5" maxlength="1500"
                                         value="#{managedBeanFacturacionManual.comentarios}">
                            <p:ajax event="change" process="@this,itaComentarios"/>
                        </p:inputTextarea>
                    </p:panelGrid>
                    <ui:include src="/facturas/conceptoDetallePart.xhtml"/>
                </p:fieldset>
                <p:fieldset legend="Conceptos" toggleable="true" toggleSpeed="500" collapsed="false">
                    <p:panelGrid columns="4" style="width: 100%;"
                                 columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-3, ui-grid-col-3"
                                 styleClass="ui-noborder">
                        <p:outputLabel for="itConcept" value="Concepto a buscar:"/>
                        <p:inputText id="itConcept" value="#{managedBeanFacturacionManual.busCop}" style="width: 80%;"
                                     title="  ">
                            <p:tooltip id="toolTipCptoBuscar" for="itConcept" showEvent="focus" hideEvent="blur">
                                <p:outputLabel value="Ingrese una cadena de texto para buscar un concepto"/>
                                <br/>
                                <p:outputLabel value="que ya este registrado, presione el boton de 'Buscar concepto'"/>
                                <br/>
                                <p:outputLabel
                                        value="para realizar la busqueda, despues seleccione el concepto en la lista de abajo."/>
                            </p:tooltip>
                        </p:inputText>
                        <p:commandButton value="Buscar concepto" icon="fa fa-fw fa-search"
                                         action="#{managedBeanFacturacionManual.buscarConcepto()}"
                                         update="msgs, somConceptos" process="@this,itConcept"
                                         onstart="PF('statusLoadingData').show()"
                                         oncomplete="PF('statusLoadingData').hide()">
                        </p:commandButton>
                        <p:commandButton id="cbCrearAgrCpto" value="Crear y agregar concepto"
                                         onclick="PF('dlgAdd').show();"
                                         action="#{managedBeanCatalogos.resetDatosBusqueda()}"
                                         process="@this"
                                         update=":frmManual:pgCptoDetail,
                                        :frmManual:pgTrasladosCptoDev,
                                        :frmManual:pgRetencionesCptoDev">
                            <p:ajax event="click"
                                    listener="#{managedBeanFacturacionManual.reiniciarDatosConcepto()}"/>
                            <p:tooltip id="toolTipCrearNC" for="cbCrearAgrCpto">
                                <p:outputLabel
                                        value="Concepto completamente nuevo, ademas de que este se guardara permanentemente"/>
                                <br/>
                                <p:outputLabel value="en los conceptos asociados a la empresa emisora seleccionada.'"/>
                                <br/>
                                <p:outputLabel value=""/>
                            </p:tooltip>
                        </p:commandButton>
                        <p:outputLabel for="somConceptos" value="Concepto:"/>
                        <p:selectOneMenu id="somConceptos" value="#{managedBeanFacturacionManual.idConcepto}"
                                         style="width: 80%;" filter="true" filterMatchMode="contains" required="false"
                                         panelStyle="width:450px;"
                                         title="Elige entre los conceptos disponibles o crea uno nuevos">
                            <f:selectItem itemLabel="Selecciona un concepto existente" itemValue="-1"
                                          noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanFacturacionManual.conceptosEmpresa}" var="c"
                                           itemValue="#{c.id}" itemLabel="#{c.conceptofacturacion}"/>
                            <p:ajax event="change" listener="#{managedBeanFacturacionManual.cargaInfoConceptoFromDB()}"
                                    process="@this,somConceptos" onsuccess="PF('dlgAdd').show();"
                                    update=":frmManual:pgCptoDetail,:frmManual:pgTrasladosCptoDev,
                                    :frmManual:pgRetencionesCptoDev,somConceptos"/>
                            <p:ajax event="change"
                                    listener="#{managedBeanCatalogos.resetDatosBusqueda}"/>
                        </p:selectOneMenu>
                    </p:panelGrid>
                    <p:separator/>
                    <p:panelGrid columns="1" style="width: 100%;" styleClass="ui-noborder">
                        <p:commandButton id="cbEliminar" value="Eliminar" icon="fa fa-fw fa-remove"
                                         action="#{managedBeanFacturacionManual.eliminarConceptosLista()}"
                                         update="dtListaConceptos,pgResumen:,@this" process="@this,dtListaConceptos"
                                         disabled="#{managedBeanFacturacionManual.flgButtonEliminarDisabled}">
                            <!--<p:confirm header="#{langes.confirm}" message="Â¿Estas seguro de eliminar los conceptos seleccionados?"  icon="ui-icon-alert" />-->
                        </p:commandButton>
                    </p:panelGrid>
                    <!--Muestra los coneptos que tiene actualmente la facura-->
                    <p:dataTable id="dtListaConceptos" styleClass="customDataTable"
                                 value="#{managedBeanFacturacionManual.conceptosAsignados}" var="tmp" rows="30"
                                 liveScroll="true"
                                 scrollable="true" rowKey="#{tmp.id}"
                                 selection="#{managedBeanFacturacionManual.conceptosAsignadosSelect}"
                                 emptyMessage="No hay conceptos asignados."
                                 style="text-align: center; font-size: 9px;" disabledTextSelection="false">

                        <p:ajax event="rowSelectCheckbox" process="@this,dtListaConceptos"/>
                        <p:ajax event="rowUnselectCheckbox" process="@this,dtListaConceptos"/>
                        <p:column selectionMode="multiple" width="3%">
                        </p:column>
                        <p:column headerText="ClavePS" width="10%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{tmp.claveProdServ}" class="customCell" style="text-align: right;"/>
                        </p:column>
                        <p:column headerText="DescripciÃ³n" width="10%" class="customCell" style="text-align: left;">
                            <h:outputText value="#{tmp.conceptofacturacion}"/>
                        </p:column>
                        <p:column headerText="Unidad" width="10%" class="customCell" style="text-align: left;">
                            <h:outputText value="#{tmp.unidad}"/>
                        </p:column>
                        <p:column headerText="Clave Unidad" width="10%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{tmp.claveUnidad}"/>
                        </p:column>
                        <p:column headerText="Descuento" width="10%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{managedBeanFacturacionManual.getFormatedNumber(tmp.descuento)}"/>
                        </p:column>
                        <p:column headerText="Valor Unitario" width="17%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{tmp.VALOR()}"/>
                        </p:column>
                        <p:column headerText="Cantidad" width="6%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{tmp.CANT()}"/>
                        </p:column>
                        <p:column headerText="Importe" width="18%" class="customCell" style="text-align: right;">
                            <h:outputText value="#{tmp.TOTAL()}"/>
                        </p:column>
                        <p:column style="text-align: center" width="6%">
                            <p:commandButton
                                    update=":frmManual:pgCptoDetail:,:frmManual:pgTrasladosCptoDev,:frmManual:pgRetencionesCptoDev,:frmManual:pgCptoDetail:"
                                    process="@this"
                                    oncomplete="PF('dlgAdd').show()"
                                    icon="fa fa-fw fa-edit" title="Modificar">
                                <f:setPropertyActionListener value="#{tmp}"
                                                             target="#{managedBeanFacturacionManual.tempConcepto}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanFacturacionManual.cargaInfoConceptoExistente(tmp)}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanCatalogos.buscarInfoProdUnidadForCptoChanges(tmp.busquedaProdServ,tmp.busquedaUnidad)}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanCatalogos.buscarIvaTasasPorFactorTras(tmp.factorIvaTras)}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanCatalogos.buscarIepsTasasPorFactorTras(tmp.factorIepsTras)}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanCatalogos.buscarTasasIsrRetenciones(tmp.factorIsrRets)}"/>
                                <p:ajax event="click"
                                        listener="#{managedBeanCatalogos.buscarTasasIvaRetenciones(tmp.factorIvaRets)}"/>
                            </p:commandButton>
                        </p:column>
                        <p:columnGroup type="footer">
                            <p:row>
                                <p:column footerText=" " width="5%" style="text-align:right"/>
                                <p:column footerText=" " width="25%" style="text-align:right"/>
                                <p:column footerText=" " width="30%" style="text-align:right"/>
                                <p:column footerText="Subtotal $:" width="20%"/>
                                <p:column
                                        footerText="#{managedBeanFacturacionManual.getFormatedNumber(managedBeanFacturacionManual.subTotal)}"
                                        width="20%"/>
                            </p:row>
                        </p:columnGroup>
                    </p:dataTable>
                </p:fieldset>

                <p:fieldset id="flsParams" legend="Campos adicionales del comprobante" toggleable="true"
                            toggleSpeed="500" collapsed="false"
                            binding="#{managedBeanFacturacionManual.fieldSetRefComp}">
                </p:fieldset>
                <!--ADDENDAS SOLO APERECERA SI ESTA EN LA LISTA DE EMPRESAS CON ADDENDA, APARECEN DE ACUERDO A LA EMPRESA-->
                <!--ADDENDA COATS-->
                <p:fieldset id="flsAddenda" legend="Addenda Volkswagen/Audi" toggleable="true" toggleSpeed="500" collapsed="false" rendered="#{managedBeanFacturacionManual.servAdenda}">

                    <p:panelGrid columns="4"
                                 columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
                                 style="width: 100%;" styleClass="ui-noborder" id="dataAddenda">


                        <p:outputLabel for="itClienteAdenda" value="Cliente addenda*" />
                        <p:selectOneMenu id="itClienteAdenda" value="#{managedBeanFacturacionManual.clienteAddenda}">
                            <f:selectItem itemLabel="Selecciona un cliente" itemValue="-1"/>
                            <f:selectItems value="#{managedBeanFacturacionManual.catalogoAdendaList}" var="catAdenda"
                                           itemValue="#{catAdenda.idTipoAdenda}" itemLabel="#{catAdenda.adenda}"/>
                           <!-- <f:selectItem itemLabel="Volkswagen" itemValue="1" rendered="#{managedBeanFacturacionManual.servAdendaVW}"/>
                            <f:selectItem itemLabel="Audi" itemValue="2" rendered="#{managedBeanFacturacionManual.servAdendaAudi}"/>-->
                            <p:ajax event="change" listener="#{managedBeanFacturacionManual.usarAddenda()}" process="@this" update="tipoAdenda"/>
                        </p:selectOneMenu>



                        <p:outputLabel for="tipoAdenda" value="Tipo addenda*" />
                        <p:selectOneMenu id="tipoAdenda" value="#{managedBeanFacturacionManual.tipoAdenda}">
                            <f:selectItem itemLabel="Selecciona un tipo de addenda" itemValue="NA" />
                            <f:selectItem itemLabel="Producto" itemValue="PROD" />
                            <f:selectItem itemLabel="Servicio" itemValue="SERV" />
                            <p:ajax event="change"
                                    listener="#{managedBeanFacturacionManual.handleChangeTipoAdenda()}"
                                    process="@this" update="@this,tipoAdenda,msgs"/>
                        </p:selectOneMenu>
                        <p:outputLabel for="itNumProv" value="Numero de Proveedor:"/>
                        <p:inputText id="itNumProv" value="#{managedBeanFacturacionManual.dataProveedorAdenda.numero}">
                            <p:ajax event="change" process="itNumProv"/>
                        </p:inputText>
                        <p:outputLabel for="itOrdComp" value="Orden de Compra:"/>
                        <p:inputText id="itOrdComp" value="#{managedBeanFacturacionManual.ordenCompraInput}">
                            <p:ajax event="change" process="itOrdComp"/>
                        </p:inputText>
                    </p:panelGrid>
                   <p:panelGrid columns="4"
                                columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
                                style="width: 100%;" styleClass="ui-noborder">

                       <p:outputLabel for="itReferenciaProveedor" value="Referencia proveedor"/>
                       <p:inputText id="itReferenciaProveedor" value="#{managedBeanFacturacionManual.dataProveedorAdenda.referencia}"/>


                       <p:outputLabel for="itNombreProvedor" value="Nombre proveedor"/>
                       <p:inputText id="itNombreProvedor" value="#{managedBeanFacturacionManual.dataProveedorAdenda.nombre}"/>
                       <p:outputLabel for="itCodigoImpuesto" value="CÃ³digo impuesto"/>
                       <p:inputText id="itCodigoImpuesto" value="#{managedBeanFacturacionManual.codigoImpuestoAdenda}"/>
                       <p:outputLabel for="itCodigoDestino" value="CÃ³digo destino"/>
                       <p:inputText id="itCodigoDestino" value="#{managedBeanFacturacionManual.dataReferenciaAdenda.codigoDestino}"/>



                       <p:outputLabel for="itRemision" value="RemisiÃ³n"/>
                       <p:inputText id="itRemision" value="#{managedBeanFacturacionManual.dataReferenciaAdenda.remision}"/>




                       <p:outputLabel for="itNombreSolicitante" value="Nombre del solicitante"/>
                       <p:inputText id="itNombreSolicitante" value="#{managedBeanFacturacionManual.dataReferenciaAdenda.nombreSolicitante}"/>

                       <p:outputLabel for="itCorreoSolicitante" value="Correo del solicitante"/>
                       <p:inputText id="itCorreoSolicitante" value="#{managedBeanFacturacionManual.dataReferenciaAdenda.correoSolicitante}"/>

                       <p:outputLabel for="itCorreoContacto" value="Correo de contacto"/>
                       <p:inputText id="itCorreoContacto" value="#{managedBeanFacturacionManual.dataReferenciaAdenda.correoContacto}"/>

                   </p:panelGrid>
                </p:fieldset>
                <p:fieldset id="flsEnvioEmail" legend="Envio de correo" toggleable="true"
                            toggleSpeed="500" collapsed="true">
                    <p:panelGrid columns="4" style="width: 100%;" styleClass="ui-noborder"
                                 columnClasses="ui-grid-col-1,ui-grid-col-2, ui-grid-col-8 ui-grid-col-1">
                        <p:outputLabel/>
                        <p:outputLabel value="Â¿Enviar Factura?"/>
                        <p:inputSwitch id="isEviarEmail" value="#{managedBeanFacturacionManual.enviarEmailCliente}"
                                       onLabel="Si" offLabel="No">
                            <p:ajax event="change" process="isEviarEmail,@this" update="itEmailsCliente,isEviarEmail"/>
                        </p:inputSwitch>
                        <p:outputLabel/>

                        <p:outputLabel/>
                        <p:outputLabel value="Emails:"/>
                        <p:inputText id="itEmailsCliente" value="#{managedBeanFacturacionManual.emailCliente}"
                                     disabled="#{!managedBeanFacturacionManual.enviarEmailCliente}" maxlength="250">
                            <p:ajax event="change" process="itEmailsCliente,@this" update="itEmailsCliente"/>
                        </p:inputText>
                        <p:outputLabel/>

                    </p:panelGrid>
                </p:fieldset>
                <!--Mostrar para agregar comprobantes relacionados cuando sea una nota de credito para una factura-->
                <p:fieldset id="flsComprobantesRelacionados" legend="Comprobantes relacionados" toggleable="true"
                            toggleSpeed="500" collapsed="false">
                    <p:panelGrid id="pgCompTipoRel" columns="6" style="width: 100%;"
                                 columnClasses="ui-grid-col-1,ui-grid-col-1, ui-grid-col-3, ui-grid-col-3, ui-grid-col-3, ui-grid-col-1"
                                 styleClass="ui-noborder">
                        <p:outputLabel/>
                        <p:outputLabel for="somTipos" value="Tipo Relacion:"/>
                        <p:selectOneMenu id="somTipos" value="#{managedBeanFacturacionManual.tipoRelacion}"
                                         style="width:80%;" required="false"
                                         requiredMessage="Debe seleccionar un tipo de relaciÃ³n."
                                         filter="false" filterMatchMode="contains"
                                         label="Selecciona el tipo de relaciÃ³n">
                            <f:selectItem itemLabel="Selecciona" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{managedBeanCatalogos.relaciones}" var="rel"
                                           itemValue="#{rel.clave}-#{rel.descripcion}"
                                           itemLabel="#{rel.clave}-#{rel.descripcion}"/>
                            <p:ajax event="change" process="@this,somTipos" update="msgs,somTipos"
                                    listener="#{managedBeanFacturacionManual.handleChangeTipoRelacion}"/>
                        </p:selectOneMenu>
                        <p:inputText id="itUuidRel" value="#{managedBeanFacturacionManual.uuidTmp}"
                                     validatorMessage="El UUID no es valido">
                           <!--<f:validateRegex-->
                                    <!--pattern="[a-f0-9A-F]{8}-[a-f0-9A-F]{4}-[a-f0-9A-F]{4}-[a-f0-9A-F]{4}-[a-f0-9A-F]{12}"/>-->
                            <p:watermark value="UUID" for="itUuidRel"/>
                        </p:inputText>
                        <p:commandButton value="Agregar UUID"
                                         action="#{managedBeanFacturacionManual.agregarUuidRelacionado()}"
                                         process="itUuidRel,@this"
                                         update="msgs,dtUuidRels,itUuidRel,cbEliminarUuid"/>
                        <p:outputLabel/>
                    </p:panelGrid>
                    <p:dataTable id="dtUuidRels" value="#{managedBeanFacturacionManual.uuidsRels}" var="tmp" rows="30"
                                 liveScroll="true"
                                 scrollable="true" rowKey="#{tmp}"
                                 selection="#{managedBeanFacturacionManual.uuidsRelsSelection}"
                                 emptyMessage="No hay facturas relacionadas."
                                 style="text-align: center; font-size: 9px;" disabledTextSelection="false">
                        <p:ajax event="rowSelectCheckbox" process="@this,dtUuidRels"/>
                        <p:ajax event="rowUnselectCheckbox" process="@this,dtUuidRels"/>
                        <p:column selectionMode="multiple" width="5%">
                        </p:column>
                        <p:column headerText="UUID">
                            <h:outputText value="#{tmp}"/>
                        </p:column>
                    </p:dataTable>
                    <p:panelGrid columns="1" style="width: 100%;" styleClass="ui-noborder">
                        <p:commandButton id="cbEliminarUuid" value="Eliminar" icon="fa fa-fw fa-remove"
                                         action="#{managedBeanFacturacionManual.eliminarUuidRelacionados()}"
                                         update="dtUuidRels,@this" process="dtUuidRels,@this"
                                         disabled="#{managedBeanFacturacionManual.flgBttonEliminarUuid}">
                        </p:commandButton>
                    </p:panelGrid>
                </p:fieldset>

                <!--Mostrar cuando la factura pase los limites establecidos para ese tipo de documento    -->
                <p:fieldset id="flsCodigoConfirmacion" legend="Codigo de  confirmaciÃ³n(Solo en caso de ser necesario)"
                            toggleable="true" toggleSpeed="500" collapsed="false">
                    <p:panelGrid columns="6" style="width: 100%;"
                                 columnClasses="ui-grid-col-1,ui-grid-col-2, ui-grid-col-3, ui-grid-col-2, ui-grid-col-3, ui-grid-col-1"
                                 styleClass="ui-noborder">
                        <p:outputLabel/>
                        <p:outputLabel for="itCodConf" value="Codigo:"/>
                        <p:inputText id="itCodConf" value="#{managedBeanFacturacionManual.codigoConfirmacion}"
                                     style="width: 80%;" required="#{managedBeanFacturacionManual.codConfRequerido}"
                                     maxlength="5" binding="#{managedBeanFacturacionManual.inputCodigoConfirmacion}"
                                     autocomplete="off">
                            <p:ajax event="change" process="itCodConf, @this" update="itCodConf"
                                    listener="#{managedBeanFacturacionManual.handleCodigoConfirmacionChange}"/>
                        </p:inputText>
                        <p:outputLabel/>
                        <p:outputLabel/>
                        <p:outputLabel/>
                    </p:panelGrid>
                </p:fieldset>
                <!--AGREGAR OTRA REFERENCIA A OTRA ADDENDA AQUI Y MODIFICAR EL MANAGEDBEAN DE FACTURACION MANUAL PARA AGREGAR SOPORTE A LA EMPRESA -->

                <!--TOTALES-->
                <!--COPY TOTALES TO EVERY CONCEPT     -->
                <p:fieldset id="fsTotales" legend="Totales">
                    <p:panelGrid id="pgResumen" style="margin-top: 3px; margin-left: 35%; width: 320px;">
                        <f:facet name="header">
                            <p:column colspan="2">Totales</p:column>
                        </f:facet>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="TotalUSD:" style="font-weight: 700;"/>
                            </p:column>
                            <p:column width="200px" style="text-align: right;">
                                <p:outputLabel id="olTotalUSD" style="font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.singleComplementoComercioExteriorData.totalUSD}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="Sub total:" style="font-weight: 700;"/>
                            </p:column>
                            <p:column width="200px" style="text-align: right;">
                                <p:outputLabel id="olSubtotal" style="font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.subTotal}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="Descuentos:" style="font-weight: 700;"/>
                            </p:column>

                            <p:column width="200px" style="text-align: right;">
                                <p:outputLabel id="olDescuento" style="font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.montoDescuento}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="Traslados:" style="font-weight: 700;"/>
                            </p:column>
                            <p:column width="200px" style="text-align: right;">
                                <p:outputLabel id="olTotalTraslados" style="font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.totalTranfer}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="Retenciones:" style="font-weight: 700;"/>
                            </p:column>
                            <p:column width="200px" style="text-align: right;">
                                <p:outputLabel id="olTotalRet" style="font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.totalReten}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column width="100px" style="width: 100px;">
                                <p:outputLabel value="Total:" style="font-weight: 700;"/>
                            </p:column>

                            <p:column width="200px" style="text-align: right; width: 200px">
                                <p:outputLabel id="olTotal" style="width: 100%; font-weight: 700;"
                                               value="#{managedBeanFacturacionManual.total}">
                                    <f:convertNumber type="currency" currencySymbol="$" locale="es_MX"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                </p:fieldset>
            </p:panel>

            <p:spacer width="450" height="1"/>
            <p:commandButton value="Generar documento"
                             styleClass="customButtonTwo"
                             process="pfDatosEmiRec:, pgDatosFactura:, pgCompTipoRel:,flsAddenda:, dataAddenda:, @this"
                             update="msgs, frmManual, pfDatosEmiRec:, pgDatosFactura:, pgCompTipoRel:, flsAddenda:, dataAddenda:"
                             action="#{managedBeanFacturacionManual.generarFactura()}"
                             onstart="PF('statusDialog').show()" oncomplete="handleFactResponse(xhr, status, args)">
            </p:commandButton>
            <p:commandButton id="hdnBtn" action="#{managedBeanCatalogos.resetDatosBusqueda}" immediate="true"
                             update="frmManual, pgDatosFactura:" style="display: none;"/>
        </h:form>
        <!--AJAX STATUS-->
        <p:dialog widgetVar="statusDialog" modal="true" position="top" draggable="false" closable="false"
                  resizable="false" showHeader="false">
            <p:graphicImage library="img" name="ajaxloadingbar.gif" alt="Procesando..."/>
        </p:dialog>
        <p:dialog widgetVar="statusLoadingData" modal="false" position="center top" draggable="false" closable="false"
                  resizable="false" showHeader="false">
            <p:graphicImage library="img" name="loadingCircleGreen.gif" alt="Cargando Datos..."/>
            <br/>
            Cargando datos ...
        </p:dialog>
    </ui:define>
</ui:composition>
